@model IEnumerable<INV_Project.Models.FACTORY>
<hr>
<div class="input-group input-group-lg">
    <div class="input-group-prepend">
        <span class="input-group-text" id="inputGroup-sizing-lg">搜尋框</span>
    </div>
    <input type="text" id="Search" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-lg">
</div>
<hr>
<table id="click" class="table table-hover table-dark">
    <thead class="bg-primary">
        <tr>
            <th class="h2">廠商編號</th>
            <th class="h2">廠商名稱</th>
            <th colspan="2" class="h2">公司地址</th>
            <th class="h2">統一編號</th>
            <th class="h2">電話</th>
            <th class="h2">傳真</th>
            <th class="h2">異動日期</th>
        </tr>
    </thead>
    <tbody id="defaultValue">
        @foreach (var item in Model)
        {
            <tr id="@item.ID">
                <td class="h2">
                    @Html.DisplayFor(modelItem => item.FACT_CODE)
                </td>
                <td class="h2">
                    @Html.DisplayFor(modelItem => item.FACT_NAME)
                </td>
                <td class="h2" colspan="2">
                    @Html.DisplayFor(modelItem => item.ADDRESS1)
                </td>
                <td class="h2">
                    @Html.DisplayFor(modelItem => item.UNIFORM)
                </td>
                <td class="h2">
                    @Html.DisplayFor(modelItem => item.TELEPHONE)
                </td>
                <td class="h2">
                    @Html.DisplayFor(modelItem => item.FAX)
                </td>
                <td class="h2">
                    @Html.DisplayFor(modelItem => item.TRN_DATE)
                </td>
            </tr>
        }
    </tbody>
    <tbody id="tbodyshow">
    </tbody>
</table>
<script>
    var page = 'Factory';
    document.getElementById('Search').focus();
    var href = "/" + page + "/Index";
    if (navigator.userAgent.indexOf("MSIE") > 0) {
        //IE
        document.onkeyup = function () {
            switch (event.keyCode) {
                case 27:
                    window.location.href = '/Factory/Index';
                    break;
            }
        }
    }
    else {
        window.onkeyup = function () {
            switch (event.keyCode) {
                case 27:
                    window.location.href = '/Factory/Index';
                    break;
            }
        }
    }
    $(document).ready(function () {
        var apiurl = location.protocol + "//" + location.hostname + ":" + location.port + "/api/Factory";

        function ajaxSearchData(keyword) {
            $.ajax({
                url: apiurl + "?search=" + keyword,
                type: 'GET',
                success: function (data) {
                    $("#tbodyshow").empty();
                    for (var i = 0; i < data.length; i++) {
                        $("#tbodyshow").append(
                            '<tr id ="' + data[i].ID + '">' +
                            '<td class="h2">' + data[i].FACT_CODE + '</td>' +
                            '<td class="h2">' + data[i].FACT_NAME + '</td>' +
                            '<td colspan="2" class="h2">' + data[i].ADDRESS1 + '</td>' +
                            '<td class="h2">' + data[i].UNIFORM + '</td>' +
                            '<td class="h2">' + data[i].TELEPHONE + '</td>' +
                            '<td class="h2">' + data[i].FAX + '</td>' +
                            '<td class="h2">' + data[i].TRN_DATE + '</td>' +
                            "</tr>"
                        );
                    }
                }
            });
        }

        $("#Search").keyup(function () {
            var searchText = $("#Search").val().toLowerCase();
            if (searchText != "") {
                $("#defaultValue").hide();
                ajaxSearchData(searchText);
            }
            else {
                $("#defaultValue").show();
            }
                
        });
        $(document).on("click", "#click tr", function () {
            var ID = $(this).attr("id");
            if (ID) {
                var date = new Date();
                date.setTime(date.getTime() + (1 * 24 * 60 * 60 * 1000));
                var expires = "; expires=" + date.toGMTString();
                document.cookie = "FID=" + ID + expires + "; path=/";
                var href = "/" + page + "/Index?ID=" + ID;
                window.location.href = href;
            }
        });
    });
</script>