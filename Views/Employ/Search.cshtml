@model IEnumerable<INV_Project.Models.EMPLOY>
@{
    ViewBag.Title = "搜尋頁面";
}

<hr>
<div class="input-group input-group-lg">
    <div class="input-group-prepend">
        <span class="input-group-text" id="inputGroup-sizing-lg">搜尋框</span>
    </div>
    <input type="text" id="Search" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-lg">
</div>
<hr>
<table id="click" class="table table-hover table-dark">
    <thead class="bg-primary">
        <tr>
            <th class="h2">業務編號</th>
            <th class="h2">業務名稱</th>
            <th class="h2">性別</th>
            <th class="h2">連絡電話</th>
            <th class="h2">行動電話</th>
            <th colspan="2" class="h2">通訊地址</th>
        </tr>
    </thead>
    <tbody id="defaultValue">
        @foreach (var item in Model)
        {
            <tr id="@item.SAL_NO">
                <td class="h2">
                    @Html.DisplayFor(modelItem => item.SAL_NO)
                </td>
                <td class="h2">
                    @Html.DisplayFor(modelItem => item.NAME)
                </td>       
                <td class="h2">
                    @Html.DisplayFor(modelItem => item.SEX)
                </td>
                <td class="h2">
                    @Html.DisplayFor(modelItem => item.TEL1)
                </td>
                <td class="h2">
                    @Html.DisplayFor(modelItem => item.BBCALL)
                </td>
                <td class="h2" colspan="2">
                    @Html.DisplayFor(modelItem => item.ADDRESS2)
                </td>
            </tr>
        }
    </tbody>
    <tbody id="tbodyshow">
    </tbody>
</table>
<script>
    document.getElementById('Search').focus();
    if (navigator.userAgent.indexOf("MSIE") > 0) {
        //IE
        document.onkeyup = function () {
            switch (event.keyCode) {
                case 27:
                    window.location.href = '/Employ/Index';
                    break;
            }
        }
    }
    else {
        window.onkeyup = function () {
            switch (event.keyCode) {
                case 27:
                    window.location.href = '/Employ/Index';
                    break;
            }
        }
    }
    $(document).ready(function () {
        var apiurl = location.protocol + "//" + location.hostname + ":" + location.port + "/api/Employ";

        function ajaxSearchData(keyword) {
            $.ajax({
                url: apiurl + "?search=" + keyword,
                type: 'GET',
                success: function (data) {
                    $("#tbodyshow").empty();
                    for (var i = 0; i < data.length; i++) {
                        $("#tbodyshow").append(
                            '<tr id ="' + data[i].SAL_NO + '">' +
                            '<td class="h2">' + data[i].SAL_NO + '</td>' +
                            '<td class="h2">' + data[i].NAME + '</td>' +
                            '<td class="h2">' + data[i].SEX + '</td>' +
                            '<td class="h2">' + data[i].TEL1 + '</td>' +
                            '<td class="h2">' + data[i].BBCALL + '</td>' +
                            '<td colspan="2" class="h2">' + data[i].ADDRESS1 + '</td>' +
                            "</tr>"
                        );
                    }
                }
            });
        }

        $("#Search").keyup(function () {
           var searchText = $("#Search").val().toLowerCase();
            if (searchText != "") {
                $("#defaultValue").hide();
                ajaxSearchData(searchText);
            }
            else {
                $("#defaultValue").show();
            }

        });
        $(document).on("click", "#click tr", function () {
            var SAL_NO = $(this).attr("id");
            if (SAL_NO) {
                var date = new Date();
                date.setTime(date.getTime() + (1 * 24 * 60 * 60 * 1000));
                var expires = "; expires=" + date.toGMTString();
                document.cookie = "SAL_NO=" + SAL_NO + expires + "; path=/";
                var href = "/Employ/Index?SAL_NO=" + SAL_NO;
                window.location.href = href;
            }
        });
    });
</script>

